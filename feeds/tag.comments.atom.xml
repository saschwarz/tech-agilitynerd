<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>tech.agilitynerd</title><link href="http://tech.agilitynerd.com/" rel="alternate"></link><link href="http://127.0.0.1:5500/feeds/tag.comments.atom.xml" rel="self"></link><id>http://tech.agilitynerd.com/</id><updated>2010-11-23T05:00:00-06:00</updated><entry><title>Blosxom Plugin for Generating Facebook Comment xids</title><link href="http://tech.agilitynerd.com/blosxom-plugin-for-generating-facebook-commen.html" rel="alternate"></link><published>2010-11-23T05:00:00-06:00</published><updated>2010-11-23T05:00:00-06:00</updated><author><name>Steve Schwarz</name></author><id>tag:tech.agilitynerd.com,2010-11-23:blosxom-plugin-for-generating-facebook-commen.html</id><summary type="html">&lt;p&gt;I've been using &lt;a class="reference external" href="http://www.blosxom.com/"&gt;Blosxom&lt;/a&gt; to power my dog agility blog for over 6
years. In the past year or so I've enabled &lt;a class="reference external" href="http://developers.facebook.com/docs/reference/plugins/comments"&gt;Facebook comments&lt;/a&gt; in
addition to my site's own comment plugin. I ran into a problem using
Facebook's comments: if the user enters a comment on a page and the URL
has any additional URL parameters then the comment is only associated
with the page when accessed with those parameters, others hitting the
page w/o parameters won't see the comments.&lt;/p&gt;
&lt;p&gt;This behavior is &lt;a class="reference external" href="http://developers.facebook.com/docs/reference/fbml/comments_%28XFBML%29"&gt;documented by Facebook&lt;/a&gt; when the &lt;tt class="docutils literal"&gt;xid&lt;/tt&gt; attribute
isn't set in &lt;tt class="docutils literal"&gt;fb:comments&lt;/tt&gt; HTML element. I didn't think I'd encounter this
situation since my blog post URLs don't contain any parameters. However,
when people link to one of my articles within Facebook, Facebook appends
various parameters to the base URL.&lt;/p&gt;
&lt;p&gt;The solution is to specify an &lt;tt class="docutils literal"&gt;xid&lt;/tt&gt; attribute in the &lt;tt class="docutils literal"&gt;fb:comments&lt;/tt&gt; element
containing the URL encoded URL of the page (Facebook's default &lt;tt class="docutils literal"&gt;xid&lt;/tt&gt;).
This causes existing comments to show up and causes comments created
when the page is loaded with URL parameters to use the same encoded URL.&lt;/p&gt;
&lt;p&gt;So I created a simple Blosxom plugin to perform the encoding so the
encoded URL can be placed in the story.html template:&lt;/p&gt;
&lt;pre class="code perl literal-block"&gt;
&lt;span class="c1"&gt;# Blosxom Plugin: urlencode -*- perl -*-&lt;/span&gt;
&lt;span class="c1"&gt;# Author: Steve Schwarz &amp;lt;http://agilitynerd.com/&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;# 2010-NOV-22    0.1 initial version.package urlencode;&lt;/span&gt;
&lt;span class="c1"&gt;# puts the urlencoded string of the URL for this page&lt;/span&gt;
&lt;span class="c1"&gt;# into $urlencode::url without any params# use this in fb.comments xid to give the same xid&lt;/span&gt;
&lt;span class="c1"&gt;# even when query params are provided&lt;/span&gt;
&lt;span class="c1"&gt;# -------------------&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="n"&gt;CGI&lt;/span&gt; &lt;span class="sx"&gt;qw/:standard/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="n"&gt;&lt;/span&gt;&lt;span class="nn"&gt;URI::&lt;/span&gt;&lt;span class="n"&gt;Escape&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;sub &lt;/span&gt;&lt;span class="nf"&gt;start&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nv"&gt;$url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;''&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;sub &lt;/span&gt;&lt;span class="nf"&gt;story&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;my&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$pkg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$filename&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$story_ref&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$title_ref&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$body_ref&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;&amp;#64;_&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="nn"&gt;urlencode::&lt;/span&gt;&lt;span class="nv"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;uri_escape&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;$blosxom::url/${blosxom::path_info}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Then it is used in the story template:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;lt;fb:comments width=&amp;quot;550&amp;quot; numposts=&amp;quot;5&amp;quot; xid=&amp;quot;$urlencode::url&amp;quot;&amp;gt;&amp;lt;/fb:comments&amp;gt;
&lt;/pre&gt;
&lt;p&gt;Now my readers won't have to worry that their comments won't show up.&lt;/p&gt;
</summary><category term="blosxom"></category><category term="comments"></category><category term="facebook"></category><category term="perl"></category></entry></feed>