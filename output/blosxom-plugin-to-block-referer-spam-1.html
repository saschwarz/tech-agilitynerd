<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>tech.agilitynerd</title>
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Steve Schwarz">
            <!-- <link href="http://tech.agilitynerd.com/TechAgilityNerd" type="application/atom+xml" rel="alternate" title="tech.agilitynerd Atom Feed" /> -->
    <link href="http://feeds.feedburner.com/TechAgilityNerd" type="application/atom+xml" rel="alternate" title="tech.agilitynerd Atom Feed" />
                <!-- Le styles -->
    <link href="./theme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
      padding-top: 60px;
      padding-bottom: 40px;
      }
      .sidebar-nav {
      padding: 9px 0;
      }
    </style>
    <link href="./theme/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="./theme/local.css" rel="stylesheet">
    <link href="./theme/pygments.css" rel="stylesheet">
          </head>
  <body>
<!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
            
    <div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
      </a>
      <a class="brand" href="./index.html">tech.agilitynerd</a>
      <div class="nav-collapse collapse">
	<ul class="nav">
	  	  	  	  	  	  <li ><a href="./category/devops.html">devops</a></li>
	  	  <li ><a href="./category/misc.html">misc</a></li>
	  	  <li ><a href="./category/programming.html">programming</a></li>
	  	  <li ><a href="./category/python.html">python</a></li>
	  	  <li class="active"><a href="./category/webdev.html">webdev</a></li>
	  	</ul>
	<p class="navbar-text pull-right">
	  <a class="navbar-link" href="./archives.html">[archives]</a>
	  <a class="navbar-link" href="./tags.html">[tags]</a>
	</p>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>
    <div class="container-fluid">
      <div class="row-fluid">
	<div class="span1">&nbsp;</div>
	<div class="span10">
	  <div class="row-fluid">
            <div class="span9">
	      	      <div class='article'>
  <div class="page-header"><h1>Blosxom Plugin to Block Referer Spam</h1></div>
  <div class="well small"><a class="more" href="./blosxom-plugin-to-block-referer-spam-1.html">On 12 Feb 2005 at 2000</a>
by <a class="url fn" href="./author/steve-schwarz.html">Steve Schwarz</a> in <a href="./category/webdev.html">webdev</a>
 | <a href="./blosxom-plugin-to-block-referer-spam-1.html#disqus_thread">Comments</a></div>
  <div><p>Like so many other bloggers who allow comments on their websites and
blog articles, I was facing increasing <a class="reference external" href="http://en.wikipedia.org/wiki/Blog_spam">comment spam</a> as my blog got
noticed by more spammers. The size of this problem is illustrated by
<a class="reference external" href="http://www.google.com/search?q=%22comment+spam%22">this Google query for &quot;comment spam&quot;</a> that returned 1.5 million hits.
For the uninitiated comment spam is like email spam for blogs; the
spammer inserts fake comments in a blog where either the comment text
contains from one to dozens of links to the spammer's websites. When web
search sites &quot;spider&quot; the blog the links to the spammer's site are
treated as &quot;endorsements&quot; of the spammer's sites and the spammer's sites
are raised to the top of the search site's result lists.</p>
<p>There is another growing type of blog spam called <a class="reference external" href="http://www.spywareinfo.com/articles/referer_spam/">referer spam</a> (yes
it is <a class="reference external" href="http://dictionary.reference.com/search?q=referer">officially misspelled</a>). When a web surfer clicks on a link in a
web page that sends them to another web page most web browsers fill in
the URL of the referring page into the request called the HTTP_REFERER.
Some websites and blogs capture that page link information when they are
on the receiving end of a web request. These sites might have a section
on each page indicating the sites that link to that page. These links
are referer links.</p>
<p>Referer spam uses the same mechanism as comment spam to raise the search
sites ranking of the spammer's websites. But referer spammer's don't
post comments; they post fake referrals to a website. The are hoping
that the website or blog displays links of the sites that refer to them.
So when the website is spidered the search ranking is raised.</p>
<div class="section" id="blosxom-plugins-addressing-spam">
<h2>Blosxom Plugins Addressing Spam</h2>
<p>Like so many bloggers once I started getting comment spam I was able to
manually delete them as they occurred. But that got old fast. After some
Googling I discovered <a class="reference external" href="http://www.lathi.net">Doug Alcorn's</a> <a class="reference external" href="http://blosxom.sourceforge.net/">Blosxom</a> <a class="reference external" href="http://www.lathi.net/twiki-bin/view/Main/BlogSpam">writeback blacklist
plugin</a>. I had been using the original <a class="reference external" href="http://www.blosxom.com/plugins/input/writeback.htm">writeback</a> plugin. Doug's
improvements provided enough protection (so far) with less than a dozen
regular expressions removing all my comment spam.</p>
<p>Referer spam started hitting me three weeks ago. What was most
infuriating was that I don't display any links of referring sites on my
site at all. So all these spammers were succeeding in doing was skewing
my site statistics and using my bandwidth with their fake referer
attacks several times a day.</p>
<p>Of course all the referer spam site's addresses contained one or more of
the same dozen blacklisted words I had already configured for comment
spam. About the same time I saw <a class="reference external" href="http://jclark.org">Jason Clark</a> post his <a class="reference external" href="http://jclark.org/weblog/WebDev/Blosxom/plugins/deferer/deferer-0-1i.html">deferer
plugin</a> to return a 301 permanent redirect for the IP address of one
particular referer spammer who was attacking his site. I thought that by
combining Doug's blacklisting plugin with Jason's immediate redirect
plugin I could reduce the referer spam from my log files.</p>
<p>This plugin hasn't removed the entries entirely from my logs, since the
initial request is still logged with a 301 status. But it has stopped
the subsequent downloading of images for the pages whose content is now
not served. Now that the log contains 301 status messages for these
requests they are ignored by my host's statistics program (<a class="reference external" href="http://awstats.sourceforge.net">Advanced Web
Statistics - AWStats</a>).</p>
<p>On a re-reading of Jason's blog entry for deferer he also mentions the
idea of white and black lists for referer filtering. So I might have
subliminally remembered his idea and implemented my refererblock plugin
based on his idea. In any event, I fully credit Jason and Doug for
giving me the ideas and code with which to put together my plugin.</p>
</div>
<div class="section" id="referer-block-plugin">
<h2>Referer Block Plugin</h2>
<p>The refererblock plugin's tar file can be downloaded <a class="reference external" href="http://data.agilitynerd.com/downloads/refererblock_0.1.tar">here</a>. It
contains the refererblock plugin already named 000refererblock so that
it runs before all other plugins (you want to discard the blacklisted
requests before all legitimate requests). A sample blacklist.txt file is
provided and contains some example regexs. It uses the same blacklist
file format and file name as Doug's writeback modification (I took the
code from his plugin with only cosmetic changes). See Doug's website for
links to the Movable Type and other blacklists.</p>
<p>The only configuration variable you can set is $log_blacklisted. If set
to a full path file name the script logs the UTC date/time, referer
string, and the page to which they were referring. You could use the
frequency of words in the rejected referer strings to fine tune the
content and ordering of your blacklist.txt file to match the spammers
hitting your site. Be aware that this file isn't trimmed so you might
want to keep an eye on its size.</p>
<p>Lastly, the zip file contains a simple Perl script you can use to test
the plugin. Execute it as:</p>
<pre class="code literal-block">
referer_test.pl http://example.com http://referer-spam.com
where the first URL is your website and the second URL is the referer
</pre>
<p>to be sent in the request. This script uses <a class="reference external" href="HTTP::Request">HTTP::Request</a> to send the
request. The script returns the status &quot;200 OK&quot; for the requested page
if it isn't blacklisted and &quot;301 Moved Permanently&quot; if the referer is
blacklisted.</p>
<p>Please let me know if you use this plugin or if you have comments or
suggestions for improving it.</p>
</div>
</div>
  </div>	
            </div><!--/span-->

	    <div class="span3">
	      <div class="author">
<h4>About</h4>
<div class="author-about">
  <p class="about">I'm Steve Schwarz a Chicago software developer and dog agility enthusiast. <a href="/pages/about.html">more</a></p>
</div>
</div>
<div class="well sidebar-nav">
    <ul class="nav nav-list">
    <li class="nav-header">Blogroll</li>
        <li><a href="http://agilitynerd.com/blog/">agilitynerd.com</a></li>
        <li><a href="http://agilitycourses.com/">agilitycourses.com</a></li>
        <li><a href="http://googility.com/">googility.com</a></li>
      </ul>
      <ul class="nav nav-list social">
    <li class="nav-header">Elsewhere</li>
        <li><a href="http://www.linkedin.com/profile/view?id=10135443">Linked in</a></li>
        <li><a href="https://github.com/saschwarz">GitHub</a></li>
        <li><a href="https://twitter.com/steveaschwarz">Twitter</a></li>
      </ul>
  </div><!--/.well -->
               <script>
  (function() {
    var cx = '001042720131993941673:szhtogqckem';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div class="search">
    <gcse:search></gcse:search>
</div>
            </div><!--/span-->

	  </div>
	</div>
      </div><!--/row-->

      <hr>

      <footer>
        <p>Powered by <a href="http://blog.getpelican.com/">Pelican</a></p>
	<p>&copy; Steve Schwarz 2015</p>
      </footer>

    </div><!--/.fluid-container-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="./theme/js/jquery-1.7.2.min.js"><\/script>')</script>
      <script src="./theme/bootstrap/js/bootstrap.min.js"></script>
      <script src="./theme/js/modernizr-2.5.3-respond-1.1.0.min.js"></script>

  </body>
</html>