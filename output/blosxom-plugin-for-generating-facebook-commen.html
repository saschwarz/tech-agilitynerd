<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>tech.agilitynerd.com</title>
    <meta name="description" content="">
    <meta name="author" content="Steve Schwarz">
        <link href="http://feeds.feedburner.com/TechAgilityNerd" type="application/atom+xml" rel="alternate" title="tech.agilitynerd.com Atom Feed" />
        
    <!-- Le styles -->
    <link href="./theme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
      padding-top: 60px;
      padding-bottom: 40px;
      }
      .sidebar-nav {
      padding: 9px 0;
      }
    </style>
    <link href="./theme/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="./theme/local.css" rel="stylesheet">
    <link href="./theme/pygments.css" rel="stylesheet">
          </head>
  <body>
<!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
            
    <div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
      </a>
      <a class="brand" href="./index.html">tech.agilitynerd.com</a>
      <div class="nav-collapse collapse">
	<ul class="nav">
	  	  	  	  	  	  <li ><a href="./category/devops.html">devops</a></li>
	  	  <li ><a href="./category/misc.html">misc</a></li>
	  	  <li ><a href="./category/programming.html">programming</a></li>
	  	  <li ><a href="./category/python.html">python</a></li>
	  	  <li class="active"><a href="./category/webdev.html">webdev</a></li>
	  	</ul>
	<p class="navbar-text pull-right">
	  <a class="navbar-link" href="./archives.html">[archives]</a>
	  <a class="navbar-link" href="./tags.html">[tags]</a>
	</p>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>
    <div class="container-fluid">
      <div class="row-fluid">
	<div class="span1">&nbsp;</div>
	<div class="span10">
	  <div class="row-fluid">
            <div class="span9">
	      	      <div class='article'>
  <div class="page-header"><h1>Blosxom Plugin for Generating Facebook Comment xids</h1></div>
  <div class="well small"><a class="more" href="./blosxom-plugin-for-generating-facebook-commen.html">On 23 Nov 2010 at 0500</a>
by <a class="url fn" href="./author/steve-schwarz.html">Steve Schwarz</a> in <a href="./category/webdev.html">webdev</a>
 | <a href="./blosxom-plugin-for-generating-facebook-commen.html#disqus_thread">Comments</a></div>
  <div><p>I've been using <a class="reference external" href="http://www.blosxom.com/">Blosxom</a> to power my dog agility blog for over 6
years. In the past year or so I've enabled <a class="reference external" href="http://developers.facebook.com/docs/reference/plugins/comments">Facebook comments</a> in
addition to my site's own comment plugin. I ran into a problem using
Facebook's comments: if the user enters a comment on a page and the URL
has any additional URL parameters then the comment is only associated
with the page when accessed with those parameters, others hitting the
page w/o parameters won't see the comments.</p>
<p>This behavior is <a class="reference external" href="http://developers.facebook.com/docs/reference/fbml/comments_%28XFBML%29">documented by Facebook</a> when the <tt class="docutils literal">xid</tt> attribute
isn't set in <tt class="docutils literal">fb:comments</tt> HTML element. I didn't think I'd encounter this
situation since my blog post URLs don't contain any parameters. However,
when people link to one of my articles within Facebook, Facebook appends
various parameters to the base URL.</p>
<p>The solution is to specify an <tt class="docutils literal">xid</tt> attribute in the <tt class="docutils literal">fb:comments</tt> element
containing the URL encoded URL of the page (Facebook's default <tt class="docutils literal">xid</tt>).
This causes existing comments to show up and causes comments created
when the page is loaded with URL parameters to use the same encoded URL.</p>
<p>So I created a simple Blosxom plugin to perform the encoding so the
encoded URL can be placed in the story.html template:</p>
<pre class="code perl literal-block">
<span class="c1"># Blosxom Plugin: urlencode -*- perl -*-</span>
<span class="c1"># Author: Steve Schwarz &lt;http://agilitynerd.com/&gt;</span>
<span class="c1"># 2010-NOV-22    0.1 initial version.package urlencode;</span>
<span class="c1"># puts the urlencoded string of the URL for this page</span>
<span class="c1"># into $urlencode::url without any params# use this in fb.comments xid to give the same xid</span>
<span class="c1"># even when query params are provided</span>
<span class="c1"># -------------------</span>
<span class="k">use</span> <span class="n">CGI</span> <span class="sx">qw/:standard/</span><span class="p">;</span>
<span class="k">use</span> <span class="n"></span><span class="nn">URI::</span><span class="n">Escape</span><span class="p">;</span>

<span class="k">sub </span><span class="nf">start</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="s">''</span><span class="p">;</span>

<span class="k">sub </span><span class="nf">story</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$pkg</span><span class="p">,</span> <span class="nv">$path</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$story_ref</span><span class="p">,</span> <span class="nv">$title_ref</span><span class="p">,</span> <span class="nv">$body_ref</span><span class="p">)</span> <span class="o">=</span> <span class="nv">&#64;_</span><span class="p">;</span>
    <span class="nv">$</span><span class="nn">urlencode::</span><span class="nv">url</span> <span class="o">=</span> <span class="n">uri_escape</span><span class="p">(</span><span class="s">&quot;$blosxom::url/${blosxom::path_info}&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="mi">1</span><span class="p">;</span>
</pre>
<p>Then it is used in the story template:</p>
<pre class="literal-block">
&lt;fb:comments width=&quot;550&quot; numposts=&quot;5&quot; xid=&quot;$urlencode::url&quot;&gt;&lt;/fb:comments&gt;
</pre>
<p>Now my readers won't have to worry that their comments won't show up.</p>
</div>
  </div>	
            </div><!--/span-->

	    <div class="span3">
	      
<img src=""/>
<h4>About</h4>
<div>
  <p class="about">I'm Steve Schwarz a software developer in the Chicago area. <a href="/pages/about.html">more</a></p>
</div>
<div class="well sidebar-nav">
    <ul class="nav nav-list">
    <li class="nav-header">Blogroll</li>
        <li><a href="http://agilitynerd.com/blog/">agilitynerd.com</a></li>
        <li><a href="http://agilitycourses.com/">agilitycourses.com</a></li>
        <li><a href="http://googility.com/">googility.com</a></li>
      </ul>
      <ul class="nav nav-list social">
    <li class="nav-header">Elsewhere</li>
        <li><a href="http://www.linkedin.com/profile/view?id=10135443">Linked in</a></li>
        <li><a href="https://github.com/saschwarz">GitHub</a></li>
      </ul>
  </div><!--/.well -->
            </div><!--/span-->

	  </div>
	</div>
      </div><!--/row-->

      <hr>

      <footer>
        <p>Powered by <a href="http://alexis.notmyidea.org/pelican/">Pelican</a></p>
	<p>&copy; Steve Schwarz 2013</p>
      </footer>

    </div><!--/.fluid-container-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="./theme/js/jquery-1.7.2.min.js"><\/script>')</script>
      <script src="./theme/bootstrap/js/bootstrap.min.js"></script>
      <script src="./theme/js/modernizr-2.5.3-respond-1.1.0.min.js"></script>

  </body>
</html>