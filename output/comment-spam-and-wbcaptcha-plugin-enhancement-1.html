<!DOCTYPE html>
<html lang="en">
<head>
        <title>Comment Spam and wbcaptcha Plugin Enhancements</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
                <link href="http://tech.agilitynerd.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="tech.agilitynerd.com Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">tech.agilitynerd.com </a></h1>
                <nav><ul>
                                                                                                    <li ><a href="./category/about.html">about</a></li>
                                    <li ><a href="./category/devops.html">devops</a></li>
                                    <li ><a href="./category/misc.html">misc</a></li>
                                    <li ><a href="./category/programming.html">programming</a></li>
                                    <li ><a href="./category/python.html">python</a></li>
                                    <li class="active"><a href="./category/webdev.html">webdev</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
        <section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="./comment-spam-and-wbcaptcha-plugin-enhancement-1.html" rel="bookmark"
           title="Permalink to Comment Spam and wbcaptcha Plugin Enhancements">Comment Spam and wbcaptcha Plugin Enhancements</a></h1>
          </header>

    <div class="entry-content">
      <footer class="post-info">
        <abbr class="published" title="2007-12-29T23:16:00">
                Sat 29 December 2007
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="./author/steve-schwarz.html">Steve Schwarz</a>
        </address>
        <p>In <a href="./category/webdev.html">webdev</a>. </p>

</footer><!-- /.post-info -->      <p>I have been fighting automated comment spam robots (see also
<a class="reference external" href="http://agilitynerd.posterous.com/refererblock-version-02-1">refererblock update</a>, and <a class="reference external" href="http://agilitynerd.posterous.com/blosxom-hit-counter-and-favorites-plugins-1">hit counter changes</a>) with my modified
writeback plugin that uses a blacklist of spam words and URLs. However,
I'm getting tired of updating the blacklist and removing spam comments
that get through the filter. So I decided to install the <a class="reference external" href="http://varg.dyndns.org/psi/pub/code/misc/wbcaptcha.html">wbcaptcha
plugin</a> written by <a class="reference external" href="http://varg.dyndns.org/psi/pub/index.html">Pasi Savolainen</a>. His plugin uses the <a class="reference external" href="http://www.figlet.org">FIGlet</a>
program to generate an ASCII &quot;image&quot; of random letters:</p>
 <div class="centered"><pre>
              _
  ___  _ __  | |__    __ _
 / _ \| '_ \ | '_ \  / _` |
|  __/| | | || | | || (_| |
 \___||_| |_||_| |_| \__,_|
 </pre></div><p>A person leaving a comment then enters the letters (enha for the image
above) as a &quot;key&quot; along with their comments. The plugin then validates
that the key matches the generated image before it allows the comment to
be posted. This is similar to the approach used by other blog software
to distinguish humans from automated spam programs.</p>
<p>Pasi's plugin worked by executing figlet in a subshell whenever someone
wanted to post a comment. I wanted to change this approach since I don't
have the ability to install figlet on my web host and I didn't want to
pay the performance cost of calling a program through the shell.</p>
<p>So I found the <a class="reference external" href="http://search.cpan.org/~jpierce/Text-FIGlet-1.06/FIGlet.pm">Text::FIGlet</a> Perl package on <a class="reference external" href="http://cpan.org/">CPAN</a> and made a few
small edits to Pasi's plugin to allow it to invoke the FIGlet Perl code
without the shell. This simplified the plugin and sped up it's
performance. I've sent my changes to Pasi in case he wants to
incorporate them in a future release of his plugin.</p>
<p>I've decided to leave my blacklist in place, since I'm sure I'll still
be facing human comment spammers looking to promote their websites. The
last change I can think to make to further discourage spammers will be
to change all &lt;a&gt; elements in comments to include the <a class="reference external" href="http://googleblog.blogspot.com/2005/01/preventing-comment-spam.html">rel=&quot;nofollow&quot;</a>
attribute supported by most portal/search websites.</p>
<p>I also took this opportunity to add some name anchors to my foot.htm and
foot.html files so clicking on the &quot;Comments&quot; link on my index pages now
takes you directly to the comments section of the individual article.
Similarly, selecting &quot;Add Your Comment&quot; and Posting a comment also show
the writeback for and the last added comment respectively. This makes
for less scrolling on long articles and multiple comments.</p>
<p>Unfortunately, I don't think this will actually reduce the spammer hits
on my site since these are due to automated &quot;bots&quot;. I doubt the spammers
actually check if their comments get posted, they are just hoping for a
comment to &quot;get through&quot; occaisionally so their sites can can get some
<a class="reference external" href="http://search.cpan.org/~jpierce/Text-FIGlet-1.06/FIGlet.pm">&quot;Google Juice&quot;</a>. So they'll keep pounding on my site although
hopefully fewer spam comments will get through.</p>
<p>Please email me at the address shown in the right hand menu bar if you
have any problems posting comments.</p>

    </div><!-- /.entry-content -->
    
  </article>
</section>
        <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
                                                    <li><a href="http://python.org">Python.org</a></li>
                                                    <li><a href="http://jinja.pocoo.org">Jinja2</a></li>
                                                    <li><a href="#">You can modify those links in your config file</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://tech.agilitynerd.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="#">You can add links in your config file</a></li>
                                                    <li><a href="#">Another social link</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>