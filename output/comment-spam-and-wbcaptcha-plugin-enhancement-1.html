<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>tech.agilitynerd.com</title>
    <meta name="description" content="">
    <meta name="author" content="Steve Schwarz">
            <!-- <link href="http://tech.agilitynerd.com/TechAgilityNerd" type="application/atom+xml" rel="alternate" title="tech.agilitynerd.com Atom Feed" /> -->
    <link href="http://feeds.feedburner.com/TechAgilityNerd" type="application/atom+xml" rel="alternate" title="tech.agilitynerd.com Atom Feed" />
                <!-- Le styles -->
    <link href="http://tech.agilitynerd.com/theme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
      padding-top: 60px;
      padding-bottom: 40px;
      }
      .sidebar-nav {
      padding: 9px 0;
      }
    </style>
    <link href="http://tech.agilitynerd.com/theme/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="http://tech.agilitynerd.com/theme/local.css" rel="stylesheet">
    <link href="http://tech.agilitynerd.com/theme/pygments.css" rel="stylesheet">
    <script>var _gaq=[['_setAccount','UA-1127677-3'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
    <script type="text/javascript">
  var disqus_shortname = "techagilitynerd"; // required: replace example with your forum shortname
  var disqus_developer = 1;
  
    var disqus_identifier = "comment-spam-and-wbcaptcha-plugin-enhancement-1.html";
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  
  (function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
  </head>
  <body>
<!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
            
    <div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
      </a>
      <a class="brand" href="http://tech.agilitynerd.com/index.html">tech.agilitynerd.com</a>
      <div class="nav-collapse collapse">
	<ul class="nav">
	  	  	  	  	  	  <li ><a href="http://tech.agilitynerd.com/category/devops.html">devops</a></li>
	  	  <li ><a href="http://tech.agilitynerd.com/category/misc.html">misc</a></li>
	  	  <li ><a href="http://tech.agilitynerd.com/category/programming.html">programming</a></li>
	  	  <li ><a href="http://tech.agilitynerd.com/category/python.html">python</a></li>
	  	  <li class="active"><a href="http://tech.agilitynerd.com/category/webdev.html">webdev</a></li>
	  	</ul>
	<p class="navbar-text pull-right">
	  <a class="navbar-link" href="http://tech.agilitynerd.com/archives.html">[archives]</a>
	  <a class="navbar-link" href="http://tech.agilitynerd.com/tags.html">[tags]</a>
	</p>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>
    <div class="container-fluid">
      <div class="row-fluid">
	<div class="span1">&nbsp;</div>
	<div class="span10">
	  <div class="row-fluid">
            <div class="span9">
	      	      <div class='article'>
  <div class="page-header"><h1>Comment Spam and wbcaptcha Plugin Enhancements</h1></div>
  <div class="well small"><a class="more" href="http://tech.agilitynerd.com/comment-spam-and-wbcaptcha-plugin-enhancement-1.html">On 29 Dec 2007 at 2316</a>
by <a class="url fn" href="http://tech.agilitynerd.com/author/steve-schwarz.html">Steve Schwarz</a> in <a href="http://tech.agilitynerd.com/category/webdev.html">webdev</a>
 | <a href="http://tech.agilitynerd.com/comment-spam-and-wbcaptcha-plugin-enhancement-1.html#disqus_thread">Comments</a></div>
  <div><p>I have been fighting automated comment spam robots (see also
<a class="reference external" href="http://agilitynerd.posterous.com/refererblock-version-02-1">refererblock update</a>, and <a class="reference external" href="http://agilitynerd.posterous.com/blosxom-hit-counter-and-favorites-plugins-1">hit counter changes</a>) with my modified
writeback plugin that uses a blacklist of spam words and URLs. However,
I'm getting tired of updating the blacklist and removing spam comments
that get through the filter. So I decided to install the <a class="reference external" href="http://varg.dyndns.org/psi/pub/code/misc/wbcaptcha.html">wbcaptcha
plugin</a> written by <a class="reference external" href="http://varg.dyndns.org/psi/pub/index.html">Pasi Savolainen</a>. His plugin uses the <a class="reference external" href="http://www.figlet.org">FIGlet</a>
program to generate an ASCII &quot;image&quot; of random letters:</p>
 <div class="centered"><pre>
              _
  ___  _ __  | |__    __ _
 / _ \| '_ \ | '_ \  / _` |
|  __/| | | || | | || (_| |
 \___||_| |_||_| |_| \__,_|
 </pre></div><p>A person leaving a comment then enters the letters (enha for the image
above) as a &quot;key&quot; along with their comments. The plugin then validates
that the key matches the generated image before it allows the comment to
be posted. This is similar to the approach used by other blog software
to distinguish humans from automated spam programs.</p>
<p>Pasi's plugin worked by executing figlet in a subshell whenever someone
wanted to post a comment. I wanted to change this approach since I don't
have the ability to install figlet on my web host and I didn't want to
pay the performance cost of calling a program through the shell.</p>
<p>So I found the <a class="reference external" href="http://search.cpan.org/~jpierce/Text-FIGlet-1.06/FIGlet.pm">Text::FIGlet</a> Perl package on <a class="reference external" href="http://cpan.org/">CPAN</a> and made a few
small edits to Pasi's plugin to allow it to invoke the FIGlet Perl code
without the shell. This simplified the plugin and sped up it's
performance. I've sent my changes to Pasi in case he wants to
incorporate them in a future release of his plugin.</p>
<p>I've decided to leave my blacklist in place, since I'm sure I'll still
be facing human comment spammers looking to promote their websites. The
last change I can think to make to further discourage spammers will be
to change all &lt;a&gt; elements in comments to include the <a class="reference external" href="http://googleblog.blogspot.com/2005/01/preventing-comment-spam.html">rel=&quot;nofollow&quot;</a>
attribute supported by most portal/search websites.</p>
<p>I also took this opportunity to add some name anchors to my foot.htm and
foot.html files so clicking on the &quot;Comments&quot; link on my index pages now
takes you directly to the comments section of the individual article.
Similarly, selecting &quot;Add Your Comment&quot; and Posting a comment also show
the writeback for and the last added comment respectively. This makes
for less scrolling on long articles and multiple comments.</p>
<p>Unfortunately, I don't think this will actually reduce the spammer hits
on my site since these are due to automated &quot;bots&quot;. I doubt the spammers
actually check if their comments get posted, they are just hoping for a
comment to &quot;get through&quot; occaisionally so their sites can can get some
<a class="reference external" href="http://search.cpan.org/~jpierce/Text-FIGlet-1.06/FIGlet.pm">&quot;Google Juice&quot;</a>. So they'll keep pounding on my site although
hopefully fewer spam comments will get through.</p>
<p>Please email me at the address shown in the right hand menu bar if you
have any problems posting comments.</p>
</div>
    <div>
    <h2>Comments</h2>
            <div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
  </div>	
            </div><!--/span-->

	    <div class="span3">
	      
<img src=""/>
<h4>About</h4>
<div>
  <p class="about">I'm Steve Schwarz a software developer in the Chicago area. <a href="/pages/about.html">more</a></p>
</div>
<div class="well sidebar-nav">
    <ul class="nav nav-list">
    <li class="nav-header">Blogroll</li>
        <li><a href="http://agilitynerd.com/blog/">agilitynerd.com</a></li>
        <li><a href="http://agilitycourses.com/">agilitycourses.com</a></li>
        <li><a href="http://googility.com/">googility.com</a></li>
      </ul>
      <ul class="nav nav-list social">
    <li class="nav-header">Elsewhere</li>
        <li><a href="http://www.linkedin.com/profile/view?id=10135443">Linked in</a></li>
        <li><a href="https://github.com/saschwarz">GitHub</a></li>
      </ul>
  </div><!--/.well -->
            </div><!--/span-->

	  </div>
	</div>
      </div><!--/row-->

      <hr>

      <footer>
        <p>Powered by <a href="http://alexis.notmyidea.org/pelican/">Pelican</a></p>
	<p>&copy; Steve Schwarz 2013</p>
      </footer>

    </div><!--/.fluid-container-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="http://tech.agilitynerd.com/theme/js/jquery-1.7.2.min.js"><\/script>')</script>
      <script src="http://tech.agilitynerd.com/theme/bootstrap/js/bootstrap.min.js"></script>
      <script src="http://tech.agilitynerd.com/theme/js/modernizr-2.5.3-respond-1.1.0.min.js"></script>

  </body>
</html>