<!DOCTYPE html>
<html lang="en">
<head>
        <title>tech.agilitynerd.com - googleanalytics</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
                <link href="http://tech.agilitynerd.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="tech.agilitynerd.com Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">tech.agilitynerd.com </a></h1>
                <nav><ul>
                                                                                                    <li ><a href="../category/about.html">about</a></li>
                                    <li ><a href="../category/devops.html">devops</a></li>
                                    <li ><a href="../category/misc.html">misc</a></li>
                                    <li ><a href="../category/programming.html">programming</a></li>
                                    <li ><a href="../category/python.html">python</a></li>
                                    <li ><a href="../category/webdev.html">webdev</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../google-analytics-for-jquery-mobile-withwithou.html">Google Analytics for JQuery Mobile With Internal and AJAX Pages</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2013-01-21T02:00:00">
                Mon 21 January 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/steve-schwarz.html">Steve Schwarz</a>
        </address>
        <p>In <a href="../category/webdev.html">webdev</a>. </p>
<p>tags: <a href="../tag/ajax.html">ajax</a><a href="../tag/googleanalytics.html">googleanalytics</a><a href="../tag/jquery.html">jquery</a><a href="../tag/jquerymobile.html">jquerymobile</a></p>
</footer><!-- /.post-info --><p>I added google analytics to my <a class="reference external" href="http://agilitycourses.com">agilitycourses.com</a>&nbsp;website and was
having problems getting the mobile version of the site to log analytics
data after the first page. Google found this very helpful blog
post:&nbsp;<a class="reference external" href="http://www.jongales.com/blog/2011/01/10/google-analytics-and-jquery-mobile/">Using Google Analytics with jQuery Mobile</a>&nbsp;and it got me very
close to my final solution.</p>
<p>Since that time jQuery Mobile has changed to&nbsp;<a class="reference external" href="http://jquerymobile.com/demos/1.0/docs/api/events.html">pageinit events</a> and
<a class="reference external" href="http://jquerymobile.com/demos/1.0/docs/api/methods.html">jqmData</a>&nbsp;for page selectors, so I had to change the first line below
to match the recomendations for the 1.x version of jQuery Mobile that
I'm using:</p>
<pre class="code javascript literal-block">
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;div:jqmData(role='page')&quot;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">'pageinit'</span><span class="p">,</span>
  <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hash</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="cm">/* urls begin with locale but track urls independent of locale: strip off leading locale */</span>
      <span class="nx">url</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^/</span><span class="p">[</span><span class="o">-</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_</span><span class="p">]{</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">}</span><span class="c1">//, '');
</span>      <span class="nx">hash</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* strip # from hash */</span>
      <span class="p">}</span>
      <span class="nx">_gaq</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="p">[</span><span class="s1">'_setAccount'</span><span class="p">,</span> <span class="s1">'UA-XXXXXXX-X'</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">'_setDomainName'</span><span class="p">,</span> <span class="s1">'example.com'</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">'_setSiteSpeedSampleRate'</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">'_trackPageLoadTime'</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">'_trackPageview'</span><span class="p">,</span> <span class="nx">url</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span><span class="p">}</span>
<span class="p">});</span>
</pre>
<p>My mobile site uses both internal pages and AJAX loaded pages. So unlike
the blog post's solution, I needed to use URLs with and without
hashtags. Per the <a class="reference external" href="http://_trackPageview">Google docs on _trackPageview</a>&nbsp;I also added a
leading slash to the hashed URL.</p>
<p>Another change for my site is urls are localized, they begin with the
locale for the user's language via <a class="reference external" href="https://github.com/carljm/django-localeurl">django-localeurl</a>. So I strip the
leading &quot;/es/&quot;, &quot;/ca-FR/&quot; or &quot;/en_GB/&quot; from the URL before sending it
to Google.</p>
<p>There are a couple other variables I push on the _gaq array. I&nbsp;log my
mobile site (m.agilitycourses.com) as a subdomain of my desktop site so
I followed the settings from the <a class="reference external" href="https://developers.google.com/analytics/devguides/collection/gajs/gaTrackingSite#domainAndSubDirectory">Google analytics</a>&nbsp;and set the domain
name. I also enabled client side page load and site speed settings.</p>
<p>So I put the code in the head of the original post in the head of my
pages and the code snippet above in the foot of the pages.</p>
<p>Hope this is helpful for others.</p>
                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../improving-site-navigation-add-titles-to-blosx-1.html" rel="bookmark"
                           title="Permalink to Improving Site Navigation - Add Titles to Blosxom Pages With storytitle">Improving Site Navigation - Add Titles to Blosxom Pages With storytitle</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2008-06-20T22:03:00">
                Fri 20 June 2008
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/steve-schwarz.html">Steve Schwarz</a>
        </address>
        <p>In <a href="../category/webdev.html">webdev</a>. </p>
<p>tags: <a href="../tag/agilitynerd.html">agilitynerd</a><a href="../tag/blosxom.html">blosxom</a><a href="../tag/googleanalytics.html">googleanalytics</a></p>
</footer><!-- /.post-info -->                <p>I've always wanted my <a class="reference external" href="http://agilitynerd.com/blog/">AgilityNerd</a> blog to serve as a reference for
interesting dog agility subjects. Consequently, I'm interested in making
it as easy as possible for readers to locate, explore, and learn more
about the sport. So improving navigation is a strong interest to me.</p>
<p>I have ...</p>
                <a class="readmore" href="../improving-site-navigation-add-titles-to-blosx-1.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://tech.agilitynerd.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>